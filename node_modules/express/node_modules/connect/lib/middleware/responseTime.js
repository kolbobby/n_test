
/*!
 * Connect - responseTime
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

/**
<<<<<<< HEAD
 * Reponse time:
 *
=======
>>>>>>> 991b7b37bff376e03bd6cb6db3a199ed971da687
 * Adds the `X-Response-Time` header displaying the response
 * duration in milliseconds.
 *
 * @return {Function}
 * @api public
 */

module.exports = function responseTime(){
  return function(req, res, next){
<<<<<<< HEAD
    var start = new Date;
=======
    var writeHead = res.writeHead
      , start = new Date;
>>>>>>> 991b7b37bff376e03bd6cb6db3a199ed971da687

    if (res._responseTime) return next();
    res._responseTime = true;

<<<<<<< HEAD
    res.on('header', function(){
      var duration = new Date - start;
      res.setHeader('X-Response-Time', duration + 'ms');
    });
=======
    // proxy writeHead to calculate duration
    res.writeHead = function(status, headers){
      var duration = new Date - start;
      res.setHeader('X-Response-Time', duration + 'ms');
      res.writeHead = writeHead;
      res.writeHead(status, headers);
    };
>>>>>>> 991b7b37bff376e03bd6cb6db3a199ed971da687

    next();
  };
};
